# 🎮 使用指南 - 机器人运动控制上位机

## 🚀 快速开始

### 第一次使用
```bash
cd ~/robot_control_gui
./start_demo.sh
```

根据您的环境选择合适的选项：
- **有图形界面**：选择选项2或4
- **无图形界面**：选择选项3或5（推荐）
- **不确定**：先尝试选项5

## 🖥️ 不同环境的使用方法

### 1. 本地Ubuntu桌面环境

**特点**：完整的图形界面支持，最佳体验

**使用方法**：
```bash
./start_demo.sh
# 选择选项4: 同时启动模拟器和QT上位机
```

**界面说明**：
- 左侧：21个关节的独立控制面板
- 右侧：连接控制、位置管理、运动状态监控
- 底部：系统日志显示

### 2. SSH远程连接

**特点**：通过网络连接到远程机器

**使用方法**：
```bash
# 启用X11转发连接
ssh -X username@hostname

# 进入项目目录
cd ~/robot_control_gui

# 启动程序
./start_demo.sh
# 选择选项4（如果X11转发正常）
# 或选择选项5（命令行模式，更稳定）
```

### 3. 服务器环境（推荐）

**特点**：无图形界面，稳定可靠

**使用方法**：
```bash
./start_demo.sh
# 选择选项5: 同时启动模拟器和无头模式演示
```

**命令行界面说明**：
```
🤖 > help                    # 查看所有命令
🤖 > connect                 # 连接机器人
🤖 > status                  # 查看状态
🤖 > set 0 45.0             # 设置关节0到45度
🤖 > enable 0                # 使能关节0
🤖 > disable 0               # 失能关节0
🤖 > zero                    # 所有关节归零
🤖 > quit                    # 退出程序
```

### 4. Docker容器环境

**特点**：隔离的运行环境

**使用方法**：
```bash
# 在容器中只能使用命令行模式
./start_demo.sh
# 选择选项5
```

## 🎯 功能详解

### 图形界面功能

#### 连接控制
- **连接机器人**：建立与机器人的通信连接
- **断开连接**：安全断开连接
- **紧急停止**：立即停止所有运动

#### 关节控制
每个关节都有独立的控制面板：
- **滑块控制**：拖拽滑块调整角度
- **数值输入**：精确输入角度值
- **使能开关**：控制关节是否响应命令
- **归零按钮**：快速将关节设置为0度

#### 位置管理
- **保存位置**：将当前所有关节角度保存为预设
- **加载位置**：恢复之前保存的位置
- **位置列表**：管理多个预设位置

#### 运动状态监控（新功能）
- **运动状态**：显示机器人当前状态
  - 🟢 静止：所有关节停止运动
  - 🟠 运动中：检测到关节运动
  - 🔴 离线：机器人未连接
- **当前速度**：显示综合运动速度（°/s）
- **运动进度**：可视化进度条
- **活跃关节**：显示启用的关节数量（如：15/21）
- **运动时间**：显示持续运动时间（MM:SS）

### 命令行功能

#### 基本命令
```bash
connect          # 连接到机器人模拟器
disconnect       # 断开连接
status           # 显示连接状态和关节信息
help             # 显示帮助信息
quit             # 退出程序
```

#### 关节控制命令
```bash
set <joint_id> <angle>     # 设置关节角度
                          # 例如: set 0 45.0

enable <joint_id>         # 使能关节
                         # 例如: enable 0

disable <joint_id>        # 失能关节
                         # 例如: disable 0

zero                     # 所有关节归零
```

#### 批量操作
```bash
enable_all              # 使能所有关节
disable_all             # 失能所有关节
show_joints             # 显示所有关节状态
```

## 🔧 高级使用

### 自定义配置

#### 修改通信端口
编辑 `robot_simulator.py`：
```python
PORT = 8080  # 修改为您需要的端口
```

#### 修改关节限制
编辑 `mainwindow.cpp` 中的关节范围：
```cpp
jointControl->setRange(-180.0, 180.0);  // 修改角度范围
```

### 与真实机器人连接

#### 串口连接
1. 修改 `robotcontroller.cpp` 中的连接方式
2. 设置正确的串口参数（波特率、数据位等）
3. 实现相应的通信协议

#### 网络连接
1. 修改目标IP地址和端口
2. 确保网络连通性
3. 根据机器人协议调整数据格式

## 📊 性能优化

### 提高响应速度
```cpp
// 在 mainwindow.cpp 中调整更新频率
m_statusUpdateTimer->setInterval(50);  // 50ms更新一次
```

### 减少CPU占用
```cpp
// 降低更新频率
m_statusUpdateTimer->setInterval(200);  // 200ms更新一次
```

## 🛡️ 安全注意事项

### 使用前检查
1. 确认机器人处于安全位置
2. 检查关节限位设置
3. 测试紧急停止功能

### 运行中监控
1. 观察运动状态面板
2. 注意异常速度或位置
3. 随时准备使用紧急停止

### 异常处理
1. 连接中断时自动停止运动
2. 超出限位时发出警告
3. 通信错误时记录日志

## 🔍 调试技巧

### 查看详细日志
```bash
# 启用详细日志
export QT_LOGGING_RULES="*.debug=true"
./robot_control_gui
```

### 网络调试
```bash
# 监控网络通信
tcpdump -i lo port 8080

# 手动测试连接
telnet localhost 8080
```

### 性能监控
```bash
# 监控CPU和内存使用
top -p $(pgrep robot_control_gui)
```

## 📝 常用操作示例

### 示例1：基本关节控制
```bash
🤖 > connect
🤖 > set 0 45.0      # 左臂关节0设置为45度
🤖 > set 8 -30.0     # 右臂关节0设置为-30度
🤖 > status          # 查看当前状态
```

### 示例2：批量操作
```bash
🤖 > connect
🤖 > enable_all      # 使能所有关节
🤖 > zero            # 所有关节归零
🤖 > disable_all     # 失能所有关节
```

### 示例3：复杂动作序列
```bash
🤖 > connect
🤖 > enable_all
# 设置一个复杂姿态
🤖 > set 0 30.0      # 左臂肩部
🤖 > set 1 -45.0     # 左臂上臂
🤖 > set 2 90.0      # 左臂前臂
🤖 > set 8 -30.0     # 右臂肩部
🤖 > set 9 45.0      # 右臂上臂
🤖 > set 10 -90.0    # 右臂前臂
🤖 > status          # 检查结果
```

## 🎯 最佳实践

### 推荐工作流程
1. **启动**：使用 `./start_demo.sh` 选择合适模式
2. **连接**：建立与机器人的连接
3. **测试**：先进行小幅度运动测试
4. **控制**：逐步进行复杂动作
5. **监控**：持续观察运动状态
6. **保存**：保存有用的位置预设

### 避免常见错误
1. 连接前确保模拟器已启动
2. 大幅度运动前检查关节限位
3. 异常情况下及时使用紧急停止
4. 定期保存重要的位置预设

---

🎉 **现在您已经掌握了机器人控制上位机的完整使用方法！**

无论是在桌面环境还是服务器环境，都能找到合适的使用方式。开始您的机器人控制之旅吧！ 🤖✨