# 机器人运动控制上位机

这是一个基于Qt5开发的机器人运动控制上位机，专门为轮臂机器人设计。

## 机器人配置

支持的机器人配置：
- **左臂**: 8个关节电机 (关节ID: 0-7)
- **右臂**: 8个关节电机 (关节ID: 8-15)  
- **腰部**: 2个关节电机 (关节ID: 16-17)
- **底盘**: 2个电机 (关节ID: 18-19)
- **升降机构**: 1个电机 (关节ID: 20)

总计：**21个自由度**

## 主要功能

### 1. 关节控制
- 每个关节都有独立的控制界面
- 支持滑块和数值输入两种控制方式
- 实时显示关节角度和位置状态
- 可视化进度条显示关节位置
- 单独的使能/失能控制
- 一键归零功能

### 2. 连接管理
- 支持多种连接方式：串口、TCP、UDP
- 实时连接状态显示
- 自动重连机制
- 连接错误处理

### 3. 位置管理
- 保存当前所有关节位置到文件
- 从文件加载关节位置
- 一键复位到零位
- 批量使能/失能所有关节

### 4. 安全功能
- 紧急停止按钮（快捷键F1）
- 关节角度限制
- 实时状态监控
- 错误日志记录

### 5. 状态监控
- 实时显示机器人连接状态
- 电池电量监控
- 系统日志显示
- 关节状态反馈

## 编译和运行

### 环境要求
- Qt5.15 或更高版本
- C++17 支持的编译器
- CMake 3.16+ 或 qmake

### 编译步骤

#### 使用qmake编译：
```bash
# 生成Makefile
qmake robot_control_gui.pro

# 编译
make

# 运行
./robot_control_gui
```

#### 使用Qt Creator：
1. 打开Qt Creator
2. 打开项目文件 `robot_control_gui.pro`
3. 配置编译套件
4. 点击运行按钮

## 使用说明

### 1. 启动应用程序
运行程序后，会看到主界面分为三个区域：
- **左侧**: 关节控制面板，按组织分类显示所有关节
- **右上**: 控制面板，包含连接、位置、关节控制等功能
- **右下**: 系统日志，显示操作记录和状态信息

### 2. 连接机器人
1. 点击"连接机器人"按钮
2. 系统会尝试连接到机器人（默认TCP连接到127.0.0.1:8080）
3. 连接成功后，状态会显示为"已连接"，按钮状态会相应更新

### 3. 控制关节
1. 确保机器人已连接
2. 在关节控制面板中选择要控制的关节
3. 使用滑块或数值输入框调整关节角度
4. 实时查看关节位置反馈

### 4. 位置管理
- **保存位置**: 将当前所有关节位置保存到.pos文件
- **加载位置**: 从.pos文件加载关节位置
- **复位零位**: 将所有关节设置为0度

### 5. 安全操作
- **紧急停止**: 立即停止所有关节运动（快捷键F1）
- **使能控制**: 可以单独或批量控制关节的使能状态

## 通信协议

### 命令格式
程序使用JSON格式与机器人通信：

#### 关节位置控制：
```json
{
    "command": "position",
    "joint": 0,
    "value": 45.0,
    "timestamp": 1234567890
}
```

#### 系统命令：
- `EMERGENCY_STOP`: 紧急停止
- `RESET_ZERO`: 复位到零位
- `ENABLE_ALL`: 使能所有关节
- `DISABLE_ALL`: 失能所有关节
- `ENABLE_JOINT <id>`: 使能指定关节
- `DISABLE_JOINT <id>`: 失能指定关节

### 状态反馈
机器人应返回JSON格式的状态信息：
```json
{
    "joints": [0.0, 45.0, -30.0, ...],
    "battery": 85.5,
    "error": ""
}
```

## 配置选项

### 连接配置
可以通过代码修改连接参数：
```cpp
// TCP连接（默认）
robotController->setConnectionType("tcp");
robotController->setTcpConnection("192.168.1.100", 8080);

// 串口连接
robotController->setConnectionType("serial");
robotController->setSerialPort("/dev/ttyUSB0", 115200);

// UDP连接
robotController->setConnectionType("udp");
robotController->setUdpConnection("192.168.1.100", 8080);
```

### 关节范围配置
不同类型的关节有不同的角度范围：
- **臂关节**: -180° 到 +180°
- **腰部关节**: -90° 到 +90°
- **底盘电机**: -1000 到 +1000 (速度单位)
- **升降机构**: 0 到 500mm (位置单位)

## 故障排除

### 常见问题

1. **无法连接机器人**
   - 检查网络连接
   - 确认机器人IP地址和端口
   - 检查防火墙设置

2. **关节不响应**
   - 确认关节已使能
   - 检查紧急停止状态
   - 查看系统日志中的错误信息

3. **界面卡顿**
   - 检查通信频率设置
   - 确认机器人响应正常
   - 重启应用程序

### 日志分析
系统日志会记录所有重要操作和错误信息：
- 连接状态变化
- 关节控制命令
- 错误和警告信息
- 系统状态更新

## 扩展开发

### 添加新功能
1. 在`MainWindow`类中添加UI组件
2. 在`RobotController`类中添加控制逻辑
3. 连接信号槽实现交互

### 自定义关节控制
可以继承`JointControlWidget`类来创建特殊的关节控制界面。

### 通信协议扩展
在`RobotController::processReceivedData()`方法中添加新的协议解析逻辑。

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请联系开发团队。